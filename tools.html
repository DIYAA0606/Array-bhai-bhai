<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StockMate – Tools</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <nav>
    <ul class="menu">
      <li><a href="index.html">🏠 Home</a></li>
      <li><a href="watchlist.html">⭐ Watchlist</a></li>
      <li><a href="tools.html" class="active">📈 Tools</a></li>
    </ul>
    <img src="logo.png" alt="StockMate Logo" class="logo" />
  </nav>

  <div class="container">
    <h1>📈 Stock Analytics & Tools</h1>

    <section id="dailyStats" style="margin-bottom: 30px;">
      <h2>📅 Daily Market Stats</h2>
      <ul id="dailyStatsList" style="list-style:none; padding-left:0; font-size: 1.1rem; color:#444;">
        <!-- Filled dynamically -->
      </ul>
    </section>

    <section id="watchlistSection" style="margin-bottom: 30px;">
      <h2>⭐ Your Watchlist</h2>
      <ul id="watchlistDisplay" style="list-style:none; padding-left:0; display:flex; flex-wrap: wrap; gap: 10px; color:#2b2b2b;">
        <!-- Watchlist items here -->
      </ul>
      <p id="watchlistEmptyMsg" style="color: #666; margin-top: 10px;">No stocks in watchlist. Add some from Home page!</p>
    </section>

    <section id="chartsSection">
      <h2>📊 Watchlist Price Trends</h2>
      <canvas id="priceChart" width="600" height="300" style="background:#fff; border-radius:8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></canvas>
      <p id="chartMsg" style="margin-top: 10px; color: #666;">Add stocks to your watchlist to see price trends here.</p>
    </section>

    <section id="extraInfo" style="margin-top: 40px;">
      <h2>🔍 Extra Info on Selected Stock</h2>
      <input type="text" id="stockInputTools" placeholder="Enter stock symbol (e.g., RELIANCE)" style="padding: 10px; font-size: 1rem; width: 300px; border-radius: 6px; border: 1px solid #ccc;" />
      <button id="fetchInfoBtn" style="margin-left: 10px; padding: 10px 15px; background: #2e7d32; color: white; border:none; border-radius: 6px; cursor: pointer;">Fetch Info</button>
      <div id="stockDetails" style="margin-top: 20px; background: #e3f2fd; padding: 15px; border-radius: 8px; min-height: 120px; max-width: 600px;">
        Enter a valid stock symbol and click Fetch Info.
      </div>
    </section>
  </div>

  <button id="darkModeToggle" title="Toggle Dark Mode">🌙</button>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="script.js"></script>

  <script>
    // Daily market stats data (dummy)
    const dailyStatsData = [
      { label: "Sensex", value: "61,500.45 (+0.58%)" },
      { label: "Nifty 50", value: "18,230.30 (+0.62%)" },
      { label: "Market Volume", value: "3.2B Shares" },
      { label: "New Highs", value: "345" },
      { label: "New Lows", value: "210" }
    ];

    // Populate daily stats
    const dailyStatsList = document.getElementById('dailyStatsList');
    dailyStatsList.innerHTML = dailyStatsData.map(stat => `<li><strong>${stat.label}:</strong> ${stat.value}</li>`).join('');

    // Elements
    const watchlistDisplay = document.getElementById('watchlistDisplay');
    const watchlistEmptyMsg = document.getElementById('watchlistEmptyMsg');
    const chartMsg = document.getElementById('chartMsg');
    const ctx = document.getElementById('priceChart').getContext('2d');
    let priceChart;

    // Utility: Get current watchlist from localStorage
    function getWatchlist() {
      return JSON.parse(localStorage.getItem('bullup_watchlist')) || [];
    }

    // Utility: Save watchlist to localStorage
    function saveWatchlist(list) {
      localStorage.setItem('bullup_watchlist', JSON.stringify(list));
    }

    // Render watchlist with remove buttons
    function renderWatchlist() {
      const list = getWatchlist();
      watchlistDisplay.innerHTML = '';
      if (list.length === 0) {
        watchlistEmptyMsg.style.display = 'block';
      } else {
        watchlistEmptyMsg.style.display = 'none';
        list.forEach(stock => {
          const li = document.createElement('li');
          li.style.background = '#fff3e0';
          li.style.padding = '6px 12px';
          li.style.borderRadius = '20px';
          li.style.fontWeight = '600';
          li.style.boxShadow = '0 2px 6px rgba(0,0,0,0.1)';
          li.style.display = 'flex';
          li.style.alignItems = 'center';
          li.style.gap = '8px';
          li.textContent = stock;

          const removeBtn = document.createElement('button');
          removeBtn.textContent = '✖';
          removeBtn.style.background = 'none';
          removeBtn.style.border = 'none';
          removeBtn.style.color = 'red';
          removeBtn.style.fontWeight = '700';
          removeBtn.style.cursor = 'pointer';
          removeBtn.title = `Remove ${stock} from Watchlist`;
          removeBtn.onclick = () => {
            const updatedList = getWatchlist().filter(s => s !== stock);
            saveWatchlist(updatedList);
            renderWatchlist();
            updateChart();
          };

          li.appendChild(removeBtn);
          watchlistDisplay.appendChild(li);
        });
      }
    }

    // Generate fake prices for chart (random walk)
    function generateFakePrices(base) {
      let prices = [];
      let price = base;
      for (let i = 6; i >= 0; i--) {
        price = price + (Math.random() - 0.5) * (price * 0.03);
        prices.unshift(Number(price.toFixed(2)));
      }
      return prices;
    }

    // Update chart based on current watchlist
    function updateChart() {
      const list = getWatchlist();
      if (list.length === 0) {
        chartMsg.style.display = 'block';
        if (priceChart) priceChart.destroy();
        return;
      }
      chartMsg.style.display = 'none';

      const datasets = list.map(stock => {
        // Use global fakeStockInfo or fallback
        let basePrice = window.fakeStockInfo?.[stock]?.price || 1000;
        return {
          label: stock,
          data: generateFakePrices(basePrice),
          borderColor: `hsl(${Math.floor(Math.random() * 360)}, 70%, 50%)`,
          fill: false,
          tension: 0.3,
          pointRadius: 4
        };
      });

      if (priceChart) priceChart.destroy();

      priceChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['6 days ago', '5 days ago', '4 days ago', '3 days ago', '2 days ago', 'Yesterday', 'Today'],
          datasets: datasets
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' },
            tooltip: { mode: 'nearest', intersect: false }
          },
          scales: { y: { beginAtZero: false } }
        }
      });
    }

    // Stock extra info fetch (reuse fakeStockInfo from script.js)
    const fetchInfoBtn = document.getElementById('fetchInfoBtn');
    const stockInputTools = document.getElementById('stockInputTools');
    const stockDetails = document.getElementById('stockDetails');

    fetchInfoBtn.addEventListener('click', () => {
      const symbol = stockInputTools.value.trim().toUpperCase();
      if (!symbol) {
        stockDetails.innerHTML = '<p style="color:red;">Please enter a stock symbol!</p>';
        return;
      }
      const info = window.fakeStockInfo?.[symbol];
      if (!info) {
        stockDetails.innerHTML = `<p style="color:red;">No data found for <strong>${symbol}</strong>. Try another.</p>`;
        return;
      }
      stockDetails.innerHTML = `
        <h3>${symbol}</h3>
        <p><strong>Price:</strong> ₹${info.price}</p>
        <p><strong>Volume:</strong> ${info.volume}</p>
        <p><strong>Sector:</strong> ${info.sector}</p>
        <p><strong>P/E Ratio:</strong> ${info.pe}</p>
        <p><strong>Dividend Yield:</strong> ${info.dividend}</p>
        <p>${info.description}</p>
      `;
    });

    // Initial rendering
    window.onload = () => {
      renderWatchlist();
      updateChart();
    };
  </script>
</body>
</html>


